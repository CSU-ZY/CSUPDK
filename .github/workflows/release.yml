name: release gdsfactory installer
on: push

jobs:
  release_add:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: true
      max-parallel: 12
      matrix:
        python-version: ["3.10"]
        os: [ubuntu-latest, macos-latest, windows-latest]
    steps:
      - name: Cancel Workflow Action
        uses: styfle/cancel-workflow-action@0.10.0
      - uses: actions/checkout@v3
      - uses: conda-incubator/setup-miniconda@v2
        with:
          python-version: "3.10"
          mamba-version: "*"
          channels: conda-forge,defaults
          channel-priority: true
          activate-environment: anaconda-client-env
      - name: Add conda to system path
        run: |
          echo $CONDA/bin >> $GITHUB_PATH
      - name: constructor build
        run: |
          mamba install constructor
          constructor .

  release_upload:
    runs-on: ubuntu-latest
    needs:
      - release_add
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            gdsfactory-5.31.0_Linux-x86_64.sh
            gdsfactory-5.31.0_Windows-x86_64.exe
            gdsfactory-5.31.0_MacOsX-x86_64.pkg
